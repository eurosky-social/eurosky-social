apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: loki-egress-kube-apiserver
  namespace: ${namespace}
  labels:
    app.kubernetes.io/instance: loki
    app.kubernetes.io/name: loki
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: loki
      app.kubernetes.io/name: loki
  policyTypes:
    - Egress
  egress:
    # Allow access to Kubernetes API server for sidecar (ConfigMap discovery)
    # API server is typically at 10.32.0.1 (cluster IP) + nodePort on nodes
    # TODO: restrict to DNS + API server only
    - ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 6443
